<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-3.1.0.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script>
function showerror(msg){
  base="127.0.0.1/error?msg="+msg
  window.location.replace(base);
}
function httpGet(theUrl)
{
  try{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false );
    xmlHttp.send( null );
    return xmlHttp.responseText;
    }catch(err) {
      console.log("Error")
    }
}
</script>
<style>
table {
  border-collapse: collapse;
  border-spacing: 2px;
  border: 1px solid green;
  text-transform: uppercase;
}

th, td {
  font-size: 30px;
  text-align: center;
  padding: 0px;
  width: 10px;
  border:2px solid green;
  height: 35px;
  

}


tr:nth-child(even) {
  background-color: #f2f2f2;
  border:1px solid green;  
}

input[type="text"] {
  width: 100%;
  height:100%;	  
  box-sizing: border-box;
  text-align: center;
  cursor: none;
  font-size : 30px;
  }
</style>
</head>
<body onload="initiate()">

<center><h2>Welcome to BONGLE!</h2>

<p id="demo"></p>

<script>
var waitingCount=500; //Initialize counter
var progressBarId = setInterval(displayProgress ,1000);
function displayProgress() {

document.getElementById("demo").fontSize='40px'

if(waitingCount<=0){
//alert()
	document.getElementById("demo").innerHTML = "'Time's Up! You completed "+ String(curr_word_index)+" levels!!";
	tabs=document.getElementsByClassName('tabs')
	for(i=0;i<tabs[curr_word_index-1].rows[0].cells.length;i++)
		{
			tabs[curr_word_index-1].rows[0].cells[i].bgColor="grey"
		}
	for(j=curr_word_index;j<6;j++)
	{
		for(i=0;i<tabs[j].rows[0].cells.length;i++)
		{
			tabs[j].rows[0].cells[i].childNodes[0].value=""
			tabs[j].rows[0].cells[i].innerText=""
		}
		if(j==(curr_word_index+1))
			document.write(j)	
	}
      num_tables=tabs.length
return
}
else{
document.getElementById("demo").innerHTML = waitingCount + " Seconds Left!";
waitingCount -=1; //decrement counter
}
 //Display the final message and clear the timer

}
</script>
<img src = "https://th.bing.com/th/id/OIP.o0m6WY2CR9Q1LVsYIWcy5AHaFj?w=261&h=196&c=7&r=0&o=5&dpr=1.2&pid=1.7"
      alt = "star1" height = "40" width = "40" draggable="true" class='star'/>
<img src = "https://th.bing.com/th/id/OIP.o0m6WY2CR9Q1LVsYIWcy5AHaFj?w=261&h=196&c=7&r=0&o=5&dpr=1.2&pid=1.7"
      alt = "star2" height = "40" width = "40" draggable="true" class='star'/>
<img src = "https://th.bing.com/th/id/OIP.o0m6WY2CR9Q1LVsYIWcy5AHaFj?w=261&h=196&c=7&r=0&o=5&dpr=1.2&pid=1.7"
      alt = "star3" height = "40" width = "40" draggable="true" class='star'/>
<img src = "https://th.bing.com/th/id/OIP.o0m6WY2CR9Q1LVsYIWcy5AHaFj?w=261&h=196&c=7&r=0&o=5&dpr=1.2&pid=1.7"
      alt = "star4" height = "40" width = "40" draggable="true" class='star'/>
<img src = "https://th.bing.com/th/id/OIP.o0m6WY2CR9Q1LVsYIWcy5AHaFj?w=261&h=196&c=7&r=0&o=5&dpr=1.2&pid=1.7"
      alt = "star5" height = "40" width = "40" draggable="true" class='star'/>

<font size="5" >
<table id='word3' width='20%' class='tabs'>
  <tr>
    <th>D</th>
    <th>E</th>
    <th>F</th>
  </tr>
</table>

<table id='word4' width='30%' class='tabs'>

  <tr>
    <th>D</th>
    <th>E</th>
    <th>F</th>
    <th>F</th>
  </tr>
  
</table>


<table id='word5' width='37%' class='tabs'>

  <tr>
    <th>D</th>
    <th>E</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
  </tr>
  
</table>

<table id='word6' width='45%' class='tabs'>

  <tr>
    <th>D</th>
    <th>E</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
  </tr>
  
</table>

<table id='word7' width='55%' class='tabs'>

  <tr>
    <th>D</th>
    <th>E</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
  </tr>
  
</table>

<table id='word8' width='65%' class='tabs'>

  <tr>
    <th>D</th>
    <th>E</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>	
  </tr>
  
</table>

<table id='word9' width='75%' class='tabs'>

  <tr>
    <th>D</th>
    <th>E</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>
    <th>F</th>	
    <th>F</th>
  </tr>
  
</table>
</font>



<br>
<button type="button" id='enter_word' onclick="addRow()">ENTER WORD!</button>


</center>
</body>
<SCRIPT language="javascript">
      console.log('requesting date');
      date=JSON.parse(httpGet("https://worldtimeapi.org/api/ip"))["datetime"].slice(0,10).replace("-","").replace("-","")
      console.log('requesting game');
      game=(httpGet("http://127.0.0.1/puzzle?date="+date)); 
      console.log('requested');
	    sequence_list=JSON.parse(game)
    	var sequence_index=0 
      var seq_len=sequence_list.length	   
      var curr_word_index=1     
        indices=new Array(9)

        function changecolor(char)
        {
		//document.write(char)
            currchar=String.fromCharCode(char)
            inp=document.activeElement
            prev_val=inp.value 
		if (char==8 ) //backspace
		{
			//document.write(prev_val)
			for(i=0;i<tabs[curr_word_index-1].rows[0].cells.length;i++)
			{
				if(tabs[curr_word_index-1].rows[0].cells[i].innerText==prev_val && tabs[curr_word_index-1].rows[0].cells[i].bgColor=='grey' && prev_val!=currchar)
				{
					if(curr_word_index>1)
					{
						tabs[curr_word_index-1].rows[0].cells[i].bgColor='white'
						tabs[curr_word_index-1].rows[0].cells[i].abbr='0'
					}
					
					
				}
				
			}
			inp.value=""
			index=inp.parentNode.cellIndex
			
			for(i=index-1;i>=0;i--)
			{
				if(tabs[curr_word_index].rows[0].cells[i].innerText=="")
				{
					tabs[curr_word_index].rows[0].cells[i].childNodes[0].focus()
					return
				}
			}
			return
		}
            tabs=document.getElementsByClassName('tabs')
            num_tables=tabs.length
		
            if(!currchar.match(/[a-z]/ig))
            {
			//document.write(char)
            	return;
            }
            currchar=currchar.toUpperCase()

            prev_word=sequence_list[sequence_index][curr_word_index-1].slice()
			index=0
            index=prev_word.indexOf(currchar, index)
			
            while(index!=-1 && index!=prev_word.length)
            {
		  	 
              
                if (tabs[curr_word_index-1].rows[0].cells[index].abbr!='1')
                {
                  tabs[curr_word_index-1].rows[0].cells[index].bgColor='grey'
                  tabs[curr_word_index-1].rows[0].cells[index].abbr='1'
                  index=-1
                  
                }
              
                else{
                index=prev_word.indexOf(currchar, index+1)
                }
            }
		
            inp.value=currchar
		index=-1

		for(i=0;i<tabs[curr_word_index-1].rows[0].cells.length;i++)
		{
			if(tabs[curr_word_index-1].rows[0].cells[i].innerText==prev_val && tabs[curr_word_index-1].rows[0].cells[i].bgColor=='grey' && prev_val!=currchar)
			{
				tabs[curr_word_index-1].rows[0].cells[i].bgColor='white'
				tabs[curr_word_index-1].rows[0].cells[i].abbr='0'

			}
		}
		for(i=0;i<tabs[curr_word_index].rows[0].cells.length;i++)
		{
			if(tabs[curr_word_index].rows[0].cells[i].childNodes[0].value==currchar)
			{
				
				for(j=i+1;j<tabs[curr_word_index].rows[0].cells.length;j++)
				{
					if(tabs[curr_word_index].rows[0].cells[j].childNodes[0].value=="")
					{
						tabs[curr_word_index].rows[0].cells[j].childNodes[0].focus()
						return
					}
				}
				button_input=document.getElementById('enter_word')
				//document.write('hello')
				button_input.focus()
			}
		}
		

		

        }
        
	  function handleDrop(event)
	  {
		 stars=document.getElementsByClassName('star')
		 //document.write(stars[0].style.visibility)
		 for(i=0;i<stars.length;i++)
		 {

			if(stars[i].style.visibility!='hidden')
			{
				stars[i].style.visibility='hidden'
				break
			}
		 }
		
		 tabs=document.getElementsByClassName('tabs')
		 
             num_tables=tabs.length
		 // inp2=document.activeElement
		 index=event.target.parentNode.cellIndex
		//document.write(event.source) 
		
	       tabs[curr_word_index].rows[0].cells[index].removeChild(tabs[curr_word_index].rows[0].cells[index].childNodes[0])
		 tabs[curr_word_index].rows[0].cells[index].innerText=sequence_list[sequence_index][curr_word_index][index]
		 tabs[curr_word_index].rows[0].cells[index].abbr='0'
		 c_index=curr_word_index
		
		 for(i=0;i<tabs[curr_word_index].rows[0].cells.length;i++)
		 {
			 //if row is not filled
			 if(tabs[curr_word_index].rows[0].cells[i].innerText=="")
			 	return
  		 }
		 //this will change curr_word_index 
		 
		 addRow()
		// tabs[c_index].rows[0].cells[index].bgColor='white'
		// tabs[c_index].rows[0].cells[index].abbr ='0'
	  }	

        function changefocus()
        {
        	tableID='maintable'
        	var table = document.getElementById(tableID)
            var rowCount = table.rows.length;
            
            var colCount = table.rows[rowCount-2].cells.length+1
            //document.write(table.rows[rowCount-1].cells[3].childNodes[0].value)
            table.rows[rowCount-1].cells[0].childNodes[0].blur();
        	table.rows[rowCount-1].cells[1].childNodes[0].focus();
            table.rows[rowCount-1].cells[1].childNodes[0].focus();
            document.getElementById('c2').focus();
        }
        
        
        
       
	 function onDragOver(event) {
       event.preventDefault();


  	event
    	.currentTarget
    	.style
    	.backgroundColor = 'yellow';
	
	}

	   function initiate()
        {
        	
        	tabs=document.getElementsByClassName('tabs')
            num_tables=tabs.length
            orig_word=sequence_list[sequence_index][0].slice()
		final_word=sequence_list[sequence_index][6].slice()
            for(i=0;i<tabs[0].rows[0].cells.length;i++)
            {
             
            	tabs[0].rows[0].cells[i].innerText=orig_word.charAt(i)
			tabs[0].rows[0].cells[i].style.color='red'
			
            }
            
		for(i=0;i<tabs[6].rows[0].cells.length;i++)
            {
             
            	tabs[6].rows[0].cells[i].innerText=final_word.charAt(i)
			tabs[6].rows[0].cells[i].style.color='red'
            }

            curr_word=sequence_list[sequence_index][1].slice()
            for(i=0;i<tabs[1].rows[0].cells.length;i++)
            {
              currchar=curr_word.charAt(i)
                  		 	
              if (!orig_word.includes(currchar))
              {                
                orig_word=orig_word.replace(currchar," ")
                tabs[1].rows[0].cells[i].innerText=""
                inp=document.createElement("input")
                inp.type="text"
                inp.maxLength=1
                inp.size=1
                inp.style.fontSize='20px'
		    inp.style.width='100%'
		    bgcolor=0
                tabs[1].rows[0].cells[i].appendChild(inp) 
                jQuery(function($) {
                      $tabs[1].rows[0].cells[i].on('keydown', function(e){
                        changecolor(event.keyCode);
                        event.preventDefault();
                      });
  });     	        
			        
		    tabs[1].rows[0].cells[i].childNodes[0].addEventListener("dragover", (event)=> {
	          bgcolor=event.target.style.borderColor;
    		    event.target.style.borderColor='yellow';
    		    event.preventDefault();
  }); 
		    
		    tabs[1].rows[0].cells[i].childNodes[0].addEventListener("dragleave", (event)=> {
    		    event.target.style.borderColor='green';
    		    event.preventDefault();
                	
    				
  });     	

		   tabs[1].rows[0].cells[i].childNodes[0].addEventListener("drop", (event)=> {
    		   event.preventDefault();
			
		   
		  
		   handleDrop(event);
    		    	
    				
  });     	
         
                tabs[1].rows[0].cells[i].childNodes[0].focus()  
              }
              else
              {
				
            	  tabs[1].rows[0].cells[i].innerText=currchar
		       
                  
              }

            }
            
            
            
            for(i=2;i<num_tables-1;i++)
            {
            	orig_word=sequence_list[sequence_index][0].slice()
                curr_word=sequence_list[sequence_index][i].slice()
            	for(j=0;j<tabs[i].rows[0].cells.length;j++)
                {
                	currchar=curr_word.charAt(j)
                	if (orig_word.includes(currchar))
                    {
                    	 orig_word=orig_word.replace(currchar," ")
                 		 tabs[i].rows[0].cells[j].innerText=currchar	
                    }		
 					else
                    {                           			
                  				tabs[i].rows[0].cells[j].innerText=""
							
                    }
                    
                }
            }
            
        }
		
        
	  function addRow() 
        {
            tabs=document.getElementsByClassName('tabs')
		//document.write('hello')
            num_tables=tabs.length
            curr_word=sequence_list[sequence_index][curr_word_index].slice()
            table=tabs[curr_word_index] 
		    var str_word=""
			for(i=0;i<table.rows[0].cells.length;i++)
			{
		        if (table.rows[0].cells[i].innerText=="")
                {		
				str_word=str_word+table.rows[0].cells[i].childNodes[0].value
               }
               else{
				
	
             	  str_word=str_word+table.rows[0].cells[i].innerText
			   
               }

            }
            if(str_word==curr_word)
            {
		    if(curr_word.length==8)
		    {
				stars=document.getElementsByClassName('star')
				count=0
				for(i=0;i<stars.length;i++)
				{
					if(stars[i].style.visibility!='hidden')
					{
						count=count+1
					}
				}	

				alert("You sexy beast, you're a "+String(count)+" star Bongler!!!!")
		    }
	          for(i=0;i<tabs[curr_word_index].rows[0].cells.length;i++)
		    {
                	
		        	if (table.rows[0].cells[i].innerText=="" || table.rows[0].cells[i].abbr=='0' )
                		{
                table.rows[0].cells[i].removeChild(table.rows[0].cells[i].childNodes[0])
                table.rows[0].cells[i].innerText=str_word.charAt(i) 
		    table.rows[0].cells[i].innerText
                    
                	}
                    else
                    {
				//if(table.rows[0].cells[i].abbr!=1)
				{
                        	table.rows[0].cells[i].bgColor="Grey"
                        	table.rows[0].cells[i].abbr="1"
				}
                        
                    }
                
            	}
            }
            else
            {
			stars=document.getElementsByClassName('star')

			 for(i=0;i<stars.length;i++)
		 	{

				if(stars[i].style.visibility!='hidden')
				{
					stars[i].style.visibility='hidden'
					break
				}
			 }
		
            	return;
            }

            table=tabs[curr_word_index-1]
            for(i=0;i<table.rows[0].cells.length;i++)
		{
                table.rows[0].cells[i].bgColor="Grey"
                table.rows[0].cells[i].abbr='1'

                table.rows[0].cells[i].style.color='black'
            }
            curr_word_index=curr_word_index+1
            curr_word=sequence_list[sequence_index][curr_word_index].slice()       	
            table=tabs[curr_word_index]
            first=0
		inp=new Array(9)
            for(i=0;i<table.rows[0].cells.length;i++)
		{
		      if (table.rows[0].cells[i].innerText=="")
                  {		
                	  inp[i]=document.createElement("input")
                    inp[i].type="text"
                    inp[i].value=""
                    inp[i].maxLength=1
                    inp[i].size=1
			   
                    inp[i].style.fontSize='20px' 	
  					
                    table.rows[0].cells[i].appendChild(inp[i]) 
                    jQuery(function($) {
                      $table.rows[0].cells[i].childNodes[0].on('keydown', function(e){
                        changecolor(event.keyCode);
                        event.preventDefault();
                      });
                      });			

 table.rows[0].cells[i].childNodes[0].addEventListener("dragover", (event)=> {
	          bgcolor=event.target.style.borderColor;
    		    event.target.style.borderColor='yellow';
    		    event.preventDefault();
  }); 
		    
		    table.rows[0].cells[i].childNodes[0].addEventListener("dragleave", (event)=> {
    		    event.target.style.borderColor='green';
    		    event.preventDefault();
                	
    				
  });     	      		

		   table.rows[0].cells[i].childNodes[0].addEventListener("drop", (event)=> {
    		   event.preventDefault();
		   handleDrop(event);
    		    	
    				
  });     	      		
                    if (first==0)
                    {
              	      table.rows[0].cells[i].childNodes[0].focus()
                      first=1
                    }
					
                }
                else
                {
                	
                }
            }
            
            
       }
        
	</SCRIPT>
</html>

